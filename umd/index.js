!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).micoDb={})}(this,function(e){"use strict";var c=function(){return(c=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)};function f(i,a,u,s){return new(u=u||Promise)(function(e,n){function t(e){try{o(s.next(e))}catch(e){n(e)}}function r(e){try{o(s.throw(e))}catch(e){n(e)}}function o(n){n.done?e(n.value):new u(function(e){e(n.value)}).then(t,r)}o((s=s.apply(i,a||[])).next())})}function b(t,r){var o,i,a,e,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,i=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(!(a=0<(a=u.trys).length&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=r.call(t,u)}catch(e){n=[6,e],i=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}}function o(t,r){var o=function(e){if(e){var n=o.get();return Object.assign(n,e),o.set(n),n}return o.get()};return o.get=function(){var e=r.get(t);return e||(e=r.init,r.set(t,e)),e},o.set=function(e){return r.set(t,e),e},o.merge=function(e){var n=r.get(t);return Object.assign(n,e),r.set(t,n),n},o}function p(e){void 0===e&&(e=21);for(var n="",t=e;t--;)n+="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW,.!@#$%^&*()=+"[64*Math.random()|0];return n}function S(e,n,t){if(e.onChange){var r=n(t),o=JSON.stringify(r);e.lastOnChange!==o&&e.onChange(r),e.lastOnChange=o}}function a(e,n){if(e){var t=Object.keys(e)[0],r=e[t];1===r?n=n.sort(function(e,n){return e[t]-n[t]}):-1===r&&(n=n.sort(function(e,n){return n[t]-e[t]}))}return n}function l(l,r){function v(e){var n=g(e);return n||d(e,n=[]),n}var g=r.get,d=r.set,e=r.waitInit,h={onChange:void 0,waitInit:function(){return Promise.resolve(e(l))},index:function(e,n){void 0===n&&(n=r.sort);var t=v(l);return r.init&&0===t.length&&h.insertOne(r.init),(t=a(n,t))[e]},count:function(){return v(l).length},find:function(o,e){void 0===e&&(e=r.sort);var n=v(l);r.init&&0===n.length&&h.insertOne(r.init),n=a(e,n);var i=Object.keys(o||{});return 0===i.length?n:"function"==typeof o?n.filter(o):n.filter(function(e){for(var n=!1,t=0;t<i.length;t++){var r=i[t];if(o[r]===e[r]){n=!0;break}}return n})},findOne:function(o){var e=v(l);r.init&&0===e.length&&h.insertOne(r.init);var i=Object.keys(o||{});return 0===i.length?e[0]||{}:("function"==typeof o?e.find(o):e.find(function(e){for(var n=!1,t=0;t<i.length;t++){var r=i[t];if(o[r]===e[r]){n=!0;break}}return n}))||{}},deleteMany:function(o){o=o||{};var e=v(l),i=Object.keys(o);if(0===i.length)return d(l,[]),e;var a=[],u=[];return e.forEach(function(e){for(var n=!1,t=0;t<i.length;t++){var r=i[t];if(o[r]===e[r]){n=!0;break}}n?a.push(e):u.push(e)}),d(l,u),S(h,g,l),a},deleteOne:function(o){o=o||{};var e=v(l),i=Object.keys(o);if(0===i.length){var n=e.shift();return d(l,e),S(h,g,l),n}var a,u=[];return e.forEach(function(e){for(var n=!1,t=0;t<i.length;t++){var r=i[t];if(o[r]===e[r]){n=!0;break}}a?u.push(e):n?a=e:u.push(e)}),d(l,u),S(h,g,l),a},updateOne:function(e,n){var t,r=n.$set,o=v(l),i=Object.keys(e);if(0===i.length)r&&(o[0]=Object.assign(o[0]||{},r));else for(var a=0;a<o.length;a++){for(var u=o[a]||{},s=!1,c=0;c<i.length;c++){var f=i[c];if(e[f]===u[f]){s=!0;break}}if(s){Object.assign(u,r),t=u;break}}return d(l,o),S(h,g,l),t},updateMany:function(e,n){for(var t=n.$set,r=v(l),o=Object.keys(e),i=[],a=0;a<r.length;a++){var u=r[a]||{},s=0===o.length;if(!s)for(var c=0;c<o.length;c++){var f=o[c];if(e[f]===u[f]){s=!0;break}}s&&(Object.assign(u,t),i.push(u))}return d(l,r),S(h,g,l),i},insertOne:function(e){var n=v(l);return e._id||(e._id=p()),n.push(e),d(l,n),S(h,g,l),n},insertMany:function(e){var n=v(l);return e.forEach(function(e){e._id||(e._id=p()),n.push(e)}),d(l,n),S(h,g,l),n},removeDuplicatie:function(e){for(var n=v(e),t=[],r=new Set,o=0;o<n.length;o++){var i=n[o],a=i[e];void 0!==a?r.has(a)||(r.add(a),t.push(i)):t.push(i)}return d(e,t),S(h,g,e),t},setAll:function(n){return f(void 0,void 0,void 0,function(){return b(this,function(e){switch(e.label){case 0:return[4,d(l,n)];case 1:return e.sent(),S(h,g,l),[2]}})})}};return h}function n(e){var i;function t(e,n,t){var r=window[e];n=s.name+s.version+"_"+n,r.setItem(n,JSON.stringify({json:t}))}function n(e,n){var t=window[e].getItem(s.name+s.version+"_"+n),r=JSON.parse(t);if(r)return r.json}function r(e,n){window[e].removeItem(s.name+s.version+"_"+n)}void 0===e&&(e="mico-db");var a={};function u(t){return new Promise(function(n){if(i)n(void 0);else{var e=window.indexedDB.open(s.name,s.version);e.onerror=console.error,e.onsuccess=function(e){i=i||e.target.result,n(void 0)},e.onupgradeneeded=function(e){(i=i||e.target.result).createObjectStore(t,{keyPath:"_id"})}}})}var s={name:e,nanoid:p,isHaveIndexedDb:void 0!==window.indexedDB,version:1,remove:function(r){return new Promise(function(n){if(!r)return n(void 0);if(!s.isHaveIndexedDb)return n(s.removeLocalStorage(r));var t=s.name+s.version;u(t).then(function(){if(i.objectStoreNames.contains(t)){var e=i.transaction([t],"readwrite").objectStore(t).delete(r);e.onerror=function(e){console.error(e),n(void 0)},e.onsuccess=n}else n(void 0)})})},collection:function(e,n){void 0===n&&(n={});var t=n.type||"indexedDB";if("sessionStorage"===t)return l(e,c(c({},n),{waitInit:s.getSessionStorage,get:function(e){return s.getSessionStorage(e)||[]},set:s.setSessionStorage}));if("localStorage"===t){var r=function(n){return f(void 0,void 0,void 0,function(){return b(this,function(e){return a[n]||(a[n]=s.getLocalStorage(n)||[]),[2,a[n]]})})};return l(e,c(c({},n),{waitInit:r,get:r,set:function(e,n){a[e]||r(e),a[e]=n,s.set(e,n)}}))}function o(n){return a[n]||(a[n]=[],s.get(n).then(function(e){a[n]=e||[]})),a[n]}return l(e,c(c({},n),{waitInit:function(r){return f(void 0,void 0,void 0,function(){var n,t;return b(this,function(e){switch(e.label){case 0:return n=a,t=r,[4,s.get(r)];case 1:return n[t]=e.sent(),[2,a[r]]}})})},get:o,set:function(e,n){a[e]||o(e),a[e]=n,s.set(e,n)}}))},localItem:function(e,n){return o(e,{init:n,type:"localStorage",set:s.setLocalStorage,get:s.getLocalStorage})},sessionItem:function(e,n){return o(e,{init:n,type:"sessionStorage",set:s.setSessionStorage,get:s.getSessionStorage})},get:function(n){return new Promise(function(t){if(!n)return t(void 0);if(!s.isHaveIndexedDb)return t(s.getLocalStorage(n));var e=s.name+s.version;u(e).then(function(){i.objectStoreNames.contains(e)?i.transaction([e]).objectStore(e).get(n).onsuccess=function(e){var n=e.target.result;t(n&&n.obj)}:t(void 0)})})},set:function(r,o){return new Promise(function(n){if(!r)return n(void 0);if(!s.isHaveIndexedDb)return n(s.setLocalStorage(r,o));var t=s.name+s.version;u(t).then(function(){if(i.objectStoreNames.contains(t)){var e=i.transaction([t],"readwrite").objectStore(t).put({obj:o,_id:r});e.onerror=function(e){console.error(e),n(void 0)},e.onsuccess=n}else n(void 0)})})},setLocalStorage:function(e,n){t("localStorage",e,n)},getLocalStorage:function(e){return n("localStorage",e)},removeLocalStorage:function(e){r("localStorage",e)},setSessionStorage:function(e,n){t("sessionStorage",e,n)},getSessionStorage:function(e){return n("sessionStorage",e)},removeSessionStorage:function(e){r("sessionStorage",e)}};return s}var t=n();e.collection=l,e.createMicoDb=n,e.default=t,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map
